\chapter{Implementasi dan Pengujian}

\section{Lingkungan Pengembangan}
Pada subbab ini akan dibahas lingkungan pengembangan yang digunakan dalam penilitian beserta dengan penyesuaian-penyesuainnya.
\subsection{Penyesuaian Lingkungan Pengembangan}
Spesifikasi lingkungan pengembangan yang digunakan oleh peneliti adalah sebagai berikut :

\begin{enumerate}
	\item \textit{Browser} Chromium.
	\item Git, dengan \textit{fork} yang mengarah kepada \textit{repository} resmi Moodle mobile.
	\item Node.js versi 14.
	\item \textit{Native build tools} Windows.
\end{enumerate} 

Penggunaan versi Node.js yang berstatus LTS sudah didukung pada \textit{branch integration} Moodle mobile. Dukungan untuk versi Node.js berstatus LTS dilakukan oleh Moodle karena Node.js versi 11 sudah tidak berstatus LTS. Perbaruan tersebut belum terintegrasi dalam \textit{branch master} Moodle mobile, karena akan dirilis pada Moodle mobile versi 4. \cite{MoodleTracker:Node11+} 

Menjalankan \texttt{npm run setup} dengan Node.js 14 akan menghasilkan \textit{error} karena file \texttt{package.json} milik Moodle app memiliki aturan seperti pada \mbox{Kode \ref{lst:package-lock:rule}} yang menyatakan bahwa versi node yang dibutuhkan secara ketat adalah Node.js versi 11. Menghapus atau mengubah bagian tersebut akan memungkinkan menjalankan \texttt{npm run setup} dengan versi 14 Node.js. 

\begin{lstlisting}[frame=single, label ={lst:package-lock:rule}, caption = Aturan pada \texttt{package-lock.json} ]
	"engines": {
    	"node": "11.x"
  	}
\end{lstlisting}

Menggunakan Node.js versi 14 menyebabkan \textit{error} terjadi saat menjalankan Moodle app. Pesan \textit{error} yang muncul adalah \texttt{Module '"E:/Gabriel/Development/Skripsi/moodleapp/node \textunderscore modules/cordova-plugin-wkuserscript/types/index"' has no exported member "WKUserS \\ criptInjectionTime"}. \textit{Error} tersebut terjadi karena pada \textit{commit aa77d0f} \texttt{WKUserScriptInjectionTime} telah dihapus\cite{moodleapp:git:wkuserscript}, sehingga menyebabkan Node.js 14 menghentikan proses eksekusi aplikasi karena dianggap adanya \textit{unhandled promise}. Moodle telah mengeluarkan perbaikan untuk masalah ini pada \textit{commit b39c5ef}\cite{moodleapp:git:wkuserscriptfix}. Implementasi fix tersebut dapat dilakukan pada \textit{branch} yang digunakan dengan mengubah kode file \texttt{package-lock.json} menjadi seperti pada \mbox{Kode \ref{lst:package-lock}} dan file \texttt{src/providers/utils/iframe.ts} pada bagian \textit{import} menjadi seperti pada \mbox{Kode \ref{lst:iframe}} dan pada fungsi \texttt{win.WKUserScript.addScript()} menjadi seperti \mbox{Kode \ref{lst:addScript}}.

\begin{lstlisting}[frame=single, label ={lst:package-lock}, caption = Perbaikan pada \texttt{package-lock.json} ]
	"version": "git+https://github.com/moodlemobile/cordova-plugin-wkuserscript.git#1ad47e75a1811cec0a944d3b8b8544b3d5e052ca",
\end{lstlisting}
 
\begin{lstlisting}[frame=single, label={lst:iframe}, caption = Perbaikan pada bagian \textit{import} file \texttt{iframe.ts}]
	import { WKUserScriptWindow } from 'cordova-plugin-wkuserscript';
\end{lstlisting}

\begin{lstlisting}[frame=single, label={lst:addScript}, caption = Perbaikan pada bagian fungsi \texttt{win.WKUserScript.addScript()} file \texttt{iframe.ts}]
	        	win.WKUserScript.addScript({
                    id: 'CoreIframeUtilsRecaptchaScript',
                    file: recaptchaPath,
                    injectionTime: win.WKUserScript.InjectionTime.END,
                });
\end{lstlisting}

Solusi diatas memungkinkan menjalankan Moodle mobile pada \textit{branch master} dengan menggunakan versi Node.js berstatus LTS. Namun karena perbaikan dan pembaruan terbatu diimplementasikan pada \textit{branch Integration}, maka \textit{branch} tersebut yang akan digunakan. 

Moodle mobile dapat dijalankan dengan menggunakan perintah \textit{npm start}.  Perintah \textit{npm start} akan memanggil sebuah \textit{script} yang kemudian menjalankan perintah \textit{npx gulp watch} dan \textit{npx ionic-app-scripts serve -b --devapp --address=0.0.0.0}, namun ketika \textit{npm start} digunakan dalam windows akan tertahan pada \textit{loop} dengan pesan \texttt{[INFO] Waiting for connectivity with npm...	}. Masalah terjebak dalam \textit{loop} tersebut dapat dihindari dengan memanggil perintah \textit{npx gulp watch} dan \textit{npx ionic-app-scripts serve -b --devapp --address=0.0.0.0} secara terpisah. 

Menjalankan Moodle mobile dengan Node.js versi 14 pada \textit{branch Integration} akan menyebabkan \textit{error} pada saat aplikasi sedang dalam proses \textit{build}. Masalah yang muncul memiliki pesan \texttt{Node Sass does not yet support your current environment: Windows 64-bit with Unsupported runtime (83)
For more information on which environments are supported please see:
\url{https://github.com/sass/node-sass/releases/tag/v4.13.1}} yang memberitahu kalau Windows 64-bit tidak dapat menjalankan node-sass dengan versi 4.13. Tetapi ketika memeriksa situs npm, ditunjukkan bahwa node-sass versi 4.13 tidak mendukung Node.js versi 14. Versi node-sass yang mendukung Node.js versi 14 adalah node-sass dengan versi 4.14\cite{node:sass}. Menjalankan ulang \textit{npm run setup} juga tidak menyelesaikan masalah karena ketika node-sass akan diunduh kembali tautan yang digunakan tidak dianggap valid. Untuk mengatasi masalah tersebut cukup mengubah file \texttt{node\_modules/node-sass/package.json} menjadi seperti \mbox{Kode \ref{node:sass version}} dan menjalankan ulang  \textit{npm run setup}.

\begin{lstlisting}[frame=single, label ={node:sass version}, caption = Perubahan versi node-sass pada \texttt{package-lock.json} ]
	{
  "_args": [
    [
      "node-sass@4.14.0",
      "D:\\gabri\\Development\\Skripsi\\moodleapp"
    ]
  ],
  "_development": true,
  "_from": "node-sass@4.14.0",
  "_id": "node-sass@4.14.0",
  "_inBundle": false,
  "_integrity": "sha512-TTWFx+ZhyDx1Biiez2nB0L3YrCZ/8oHagaDalbuBSlqXgUPsdkUSzJsVxeDO9LtPB49+Fh3WQl3slABo6AotNw==",
  "_location": "/node-sass",
  "_phantomChildren": {
    "escape-string-regexp": "1.0.5",
    "has-ansi": "2.0.0",
    "lru-cache": "4.1.5",
    "strip-ansi": "3.0.1",
    "which": "1.3.1"
  },
  "_requested": {
    "type": "version",
    "registry": true,
    "raw": "node-sass@4.14.0",
    "name": "node-sass",
    "escapedName": "node-sass",
    "rawSpec": "4.14.0",
    "saveSpec": null,
    "fetchSpec": "4.14.0"
  },
  "_requiredBy": [
    "/@ionic/app-scripts"
  ],
  "_resolved": "https://registry.npmjs.org/node-sass/-/node-sass-4.14.0.tgz",
  "_spec": "4.14.0",
  "_where": "D:\\gabri\\Development\\Skripsi\\moodleapp",
  "author": {
    "name": "Andrew Nesbitt",
    "email": "andrewnez@gmail.com",
    "url": "http://andrew.github.com"
  },
  "bin": {
    "node-sass": "bin/node-sass"
  },
  "bugs": {
    "url": "https://github.com/sass/node-sass/issues"
  },
  "dependencies": {
    "async-foreach": "^0.1.3",
    "chalk": "^1.1.1",
    "cross-spawn": "^3.0.0",
    "gaze": "^1.0.0",
    "get-stdin": "^4.0.1",
    "glob": "^7.0.3",
    "in-publish": "^2.0.0",
    "lodash": "^4.17.15",
    "meow": "^3.7.0",
    "mkdirp": "^0.5.1",
    "nan": "^2.13.2",
    "node-gyp": "^3.8.0",
    "npmlog": "^4.0.0",
    "request": "^2.88.0",
    "sass-graph": "^2.2.4",
    "stdout-stream": "^1.4.0",
    "true-case-path": "^1.0.2"
  },
  "description": "Wrapper around libsass",
  "devDependencies": {
    "coveralls": "^3.0.2",
    "eslint": "^3.4.0",
    "fs-extra": "^0.30.0",
    "istanbul": "^0.4.2",
    "mocha": "^3.1.2",
    "mocha-lcov-reporter": "^1.2.0",
    "object-merge": "^2.5.1",
    "read-yaml": "^1.0.0",
    "rimraf": "^2.5.2",
    "sass-spec": "git+https://github.com/sass/sass-spec.git#dc2d573",
    "unique-temp-dir": "^1.0.0"
  },
  "engines": {
    "node": ">=0.10.0"
  },
  "files": [
    "bin",
    "binding.gyp",
    "lib",
    "scripts",
    "src",
    "test",
    "vendor"
  ],
  "gypfile": true,
  "homepage": "https://github.com/sass/node-sass",
  "keywords": [
    "css",
    "libsass",
    "preprocessor",
    "sass",
    "scss",
    "style"
  ],
  "libsass": "3.5.4",
  "license": "MIT",
  "main": "lib/index.js",
  "name": "node-sass",
  "nodeSassConfig": {
    "binarySite": "https://github.com/sass/node-sass/releases/download/"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/sass/node-sass.git"
  },
  "scripts": {
    "build": "node scripts/build.js --force",
    "coverage": "node scripts/coverage.js",
    "install": "node scripts/install.js",
    "lint": "eslint bin/node-sass lib scripts test",
    "postinstall": "node scripts/build.js",
    "prepublish": "not-in-install && node scripts/prepublish.js || in-install",
    "test": "mocha test/{*,**/**}.js"
  },
  "version": "4.14.0"
}

\end{lstlisting}

Mengubah versi node-sass akan menyelesaikan \textit{error} yang terjadi dalam proses \textit{build}. Saat aplikasi berjalan akan muncul kembali \textit{error} dengan pesan \texttt{Property 'InjectionTime' does not exist on type 'WKUserScript'}. Setelah ditelursuri, penghapusan \texttt{WKUserScriptInjectionTime} pada \textit{branch integration} tidak pernah terjadi karena variable tersebut berada dalam file \texttt{index.d.ts} yang berada di folder \texttt{node\_ modules}, dan folder terdaftar dalam \texttt{.gitignore}. Mengatasi \textit{error} tersebut dapat dilakukan dengan mengubah file \texttt{index.d.ts} menjadi seperti \mbox{Kode \ref{index.d.ts}}. Dengana melakukan perubahan tersebut Moodle mobile akan dapat dijalankan tanpa menyebabkan \textit{error}.

\begin{lstlisting}[frame=single, label ={index.d.ts}, caption = Perubahan pada \texttt{node\_ modules/cordova-plugin-wkuserscript/types/index.d.ts} ]
	
/**
 * Window instance with the plugin object.
 */
export interface WKUserScriptWindow extends Window {
    WKUserScript?: WKUserScript;
}

/**
 * Data to pass for a script.
 */
export interface WKUserScriptData {

    /**
     * An ID to identify the script, to prevent loading the same script twice.
     */
    id: string;

    /**
     * The JS code of the script.
     */
    code?: string;

    /**
     * The path of a JS file to add to the script.
     */
    file?: string;

    /**
     * Injection time. Defaults to WKUserScriptInjectionTime.START.
     */
    injectionTime?: number;
}


/**
 * Provides some functions to add user scripts in WKWebView in iOS.
 */
interface WKUserScript {

    /**
     * Injection times.
     */
    InjectionTime: {
        START: 0;
        END: 1;
    };

    /**
     * Add a user script.
     *
     * @param data Data for the script to add.
     * @return Promise resolved when done.
     */
    addScript(data: WKUserScriptData): Promise<void>;
}

export declare var WKUserScript: WKUserScript;

\end{lstlisting}

\section{Penyesuaian Tema}
Tema bawaan Moodle mobile akan diubah untuk menyesuaiakna seperti apa yang sudah dibahas pada subbab \ref{sec:Kondisi IDE UNPAR}. Implementasi perubahan-perubahan tersebut akan dibahas pada subbab subbab berikut.

\subsection{Penyesuaian skema warna}
Skema warna yang digunakan oleh IDE UNPAR adalah warna putih dengan kode \texttt{\#ffffff}, abu-abu dengan kode \texttt{\#565656} dan hijau dengan kode \texttt{\#0d8722}.  Warna-warna tersebut adalah warna utama yang terlihat ketika membuka IDE UNPAR sebagai mahasiswa. Sehingga warna-warna tersebut akan menjadi fokus utama untuk pengubahan skema warna pada Moodle mobile.

Mengubah warna yang digunakan oleh Moodle mobile dapat dilakukan dengan menambah dan mengganti variable warna yang berada pada \texttt{src/theme/variables.scss}. Karena Moodle mobile sudah menggunakan warna putih dan abu-abu, maka warna yang harus ditambahkan adalah warna hijau. Penambahan warna hijau IDE UNPAR dapat dilakukan dengan menambahkan vairable warna baru dan mengganti nilai variable \texttt{\$core-color} seperti pada \mbox{Kode \ref{variablse.scss}}.

\begin{lstlisting}[frame=single, label ={variable.scss}, caption = Mengubah warna utama menjadi warna hijau ]
$green :          #0d8722; // IDE Main color

... 

$core-color:          $green !default;
\end{lstlisting}